<?xml version="1.0"?>

<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:noNamespaceSchemaLocation="/Users/asanchez/rti/release/rti_connext_dds-6.0.0/resource/schema/rti_routing_service.xsd">

    <qos_library name="RsShapesQosLib">
        <qos_profile name="RsShapesQosProfile">
            <datareader_qos>
                <history>
                    <kind>KEEP_LAST_HISTORY_QOS</kind>
                </history>
            </datareader_qos>
        </qos_profile>
    </qos_library>
    <plugin_library name="ShapesPluginLib">
        <processor_plugin name="ShapesProcessor">
            <dll>shapesprocessor</dll>
            <create_function>
                ShapesProcessorPlugin_create_processor_plugin
            </create_function>
        </processor_plugin>
    </plugin_library>   
    
    <routing_service name="RsShapesAggregator">

        <annotation>
            <documentation>
                Aggregates Squares And Circles from domain 0 into Triangles on domain 1
            </documentation>
        </annotation>

        <domain_route>
            
            <participant name="domain0">
                <domain_id>0</domain_id>
            </participant>
            <participant name="domain1">
                <domain_id>1</domain_id>
            </participant>

            <session>
                
                <topic_route name="SquaresAndCirclestoTriangles">
                    <processor plugin_name="ShapesPluginLib::ShapesProcessor">
                        <property>
                            <value>
                                <element>
                                    <name>shapes_processor.kind</name>
                                    <value>aggregator</value>
                                </element>
                            </value>
                        </property>
                    </processor>
                    <input name="Square" participant="domain0">
                        <registered_type_name>ShapeType</registered_type_name>
                        <creation_mode>ON_DOMAIN_OR_ROUTE_MATCH</creation_mode>
                        <datareader_qos base_name="RsShapesQosLib"/>
                    </input>
                    <input name="Circle" participant="domain0">
                        <registered_type_name>ShapeType</registered_type_name>
                        <creation_mode>ON_DOMAIN_OR_ROUTE_MATCH</creation_mode>
                        <datareader_qos base_name="RsShapesQosLib"/>
                    </input>
                    <output name="Triangle" participant="domain1">
                        <registered_type_name>ShapeType</registered_type_name>
                        <creation_mode>ON_DOMAIN_MATCH</creation_mode>
                    </output>
                </topic_route>

            </session>

        </domain_route>
        
    </routing_service>


    <routing_service name="RsShapesSplitter">

        <annotation>
            <documentation>
                Splits Squares from domain 0 into Circles and Trinagles on domain 1
            </documentation>
        </annotation>

        <domain_route>

            <participant name="domain0">
                <domain_id>0</domain_id>
            </participant>
            <participant name="domain1">
                <domain_id>1</domain_id>
            </participant>

            <session>

                <topic_route name="SquaresToCirclesAndTriangles">
                    <processor plugin_name="ShapesPluginLib::ShapesProcessor"/>
                    <input name="Square" participant="domain0">
                        <registered_type_name>ShapeType</registered_type_name>
                        <creation_mode>ON_DOMAIN_MATCH</creation_mode>
                        <datareader_qos base_name="RsShapesQosLib"/>
                    </input>
                    <output name="Circle" participant="domain1">
                        <registered_type_name>ShapeType</registered_type_name>
                        <creation_mode>ON_DOMAIN_OR_ROUTE_MATCH</creation_mode>
                    </output>
                    <output name="Triangle" participant="domain1">
                        <registered_type_name>ShapeType</registered_type_name>
                        <creation_mode>ON_DOMAIN_OR_ROUTE_MATCH</creation_mode>
                    </output>
                </topic_route>

            </session>

        </domain_route>

    </routing_service>

</dds>
