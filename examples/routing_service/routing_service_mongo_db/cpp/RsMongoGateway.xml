<?xml version="1.0"?>
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:noNamespaceSchemaLocation="https://community.rti.com/schema/latest/rti_routing_service.xsd">

    <configuration_variables>
        <value>
            <element>
                <name>CLUSTER_ADDRESS</name>
                <value>cluster0.8u6dg.mongodb.net</value>
            </element>
            <element>
                <name>DB_NAME</name>
                <value>dds_space</value>
            </element>
        </value>
    </configuration_variables>

    <plugin_library name="AdapterLib">
        <adapter_plugin name="MongoAdapter">
            <dll>mongodbadapter</dll>
            <create_function>MongoAdapter_create_adapter_plugin</create_function>
        </adapter_plugin>
    </plugin_library>
    
    <routing_service name="MongoGateway">
        <domain_route name="DdsMongo">
            <!-- Define a single MongoDB connection to a specific cluster and database -->
            <connection name="MongoConnection" plugin_name="AdapterLib::MongoAdapter">
                <property>
                    <value>
                        <element>
                            <name>mongo.cluster_address</name>
                            <value>$(CLUSTER_ADDRESS)</value>
                        </element>
                        <element>
                            <name>mongo.db_name</name>
                            <value>$(DB_NAME)</value>
                        </element>
                        <!--
                             For security, this value shall provided through the
                             command-line -D option.
                        -->
                        <element>
                            <name>mongo.user_and_pass</name>
                            <value>$(USER_AND_PASS)</value>
                        </element>
                    </value>
                </property>
            </connection>

            <participant name="DdsDomain">
                <domain_id>0</domain_id>
            </participant>
            
            <session>
                <!-- Use a several address to serve all the Topcs -->
                <thread_pool>
                    <size>4</size>
                </thread_pool>
                <!-- Establish a simple DDS Topic -> MongoDB Collection mapping -->
                <auto_route>
                    <dds_input participant="DdsDomain">
                        <allow_topic_name_filter>*</allow_topic_name_filter>
                        <allow_registered_type_name_filter>*</allow_registered_type_name_filter>
                        <deny_topic_name_filter>rti/*</deny_topic_name_filter>
                    </dds_input>
                    <output connection="MongoConnection">
                        <allow_stream_name_filter>*</allow_stream_name_filter>
                        <allow_registered_type_name_filter>*</allow_registered_type_name_filter>
                        <deny_stream_name_filter>rti/*</deny_stream_name_filter>
                    </output>
                </auto_route>
            </session>
        </domain_route>
    </routing_service>

</dds>
